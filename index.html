<!DOCTYPE html>
<html lang="pt-BR" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curtindo SC - Imóveis à Venda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .modal { display: none; }
        .modal.show { display: flex; }
        .property-card:hover .property-image { transform: scale(1.05); }
        .property-image { transition: transform 0.3s ease-in-out; }
        .thumbnail-container { scrollbar-width: thin; scrollbar-color: #4B5563 #1F2937; }
        .thumbnail-container::-webkit-scrollbar { height: 8px; }
        .thumbnail-container::-webkit-scrollbar-track { background: #1F2937; }
        .thumbnail-container::-webkit-scrollbar-thumb { background-color: #4B5563; border-radius: 4px; }
        .thumbnail { cursor: pointer; border: 2px solid transparent; transition: border-color 0.2s; }
        .thumbnail.active { border-color: #3B82F6; }
        .gallery-arrow { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0, 0, 0, 0.5); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background-color 0.2s; }
        .gallery-arrow:hover { background-color: rgba(0, 0, 0, 0.8); }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div class="container mx-auto p-4 md:p-8">
        <div class="absolute top-4 right-4">
            <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                <svg id="theme-icon-sun" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="theme-icon-moon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </div>
        <header class="text-center mb-12 pt-10">
            <img src="https://media.bio.site/sites/15fc0509-6c95-4782-9a79-fe69fe78ce69/fetqsktutwxDYURdXexgei.jpg" alt="Logo Curtindo SC" class="mx-auto mb-4 h-32 w-32 object-cover rounded-full border-4 border-white dark:border-gray-700 shadow-lg">
            <h1 class="text-5xl font-bold text-gray-900 dark:text-white">Curtindo SC Imóveis</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2 text-lg">Encontre o imóvel dos seus sonhos em Santa Catarina</p>
        </header>

        <section class="mb-12 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-900 dark:text-white">Valorização Imobiliária no Litoral de SC</h2>
            <p class="text-center text-gray-600 dark:text-gray-400 mb-6 text-sm">Fonte: Dados simulados baseados no índice FipeZAP+ (2025 é uma projeção)</p>
            <div class="h-64 md:h-80">
                <canvas id="appreciation-chart"></canvas>
            </div>
        </section>

        <div id="filter-container" class="flex justify-center flex-wrap gap-2 md:gap-4 mb-10">
            <button data-filter="all" class="filter-btn active bg-gray-900 text-white px-6 py-2 rounded-full font-semibold shadow-md">Todos</button>
        </div>
        <main id="properties-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></main>
        <div id="loading" class="text-center py-12"><p class="text-gray-600 dark:text-gray-400 text-lg">A carregar os melhores imóveis...</p></div>
    </div>

    <footer class="bg-white dark:bg-gray-800 mt-16 border-t border-gray-200 dark:border-gray-700">
        <div class="container mx-auto py-8 px-4">
            <div class="text-center text-gray-600 dark:text-gray-400">
                <p class="font-bold text-lg text-gray-800 dark:text-white">Curtindo SC Imóveis</p>
                <p class="text-sm mt-2">Transformando sonhos em realidade no litoral e na serra catarinense.</p>
                <div class="flex justify-center space-x-6 mt-4">
                    <a href="#" class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><i class="fab fa-instagram fa-lg"></i></a>
                    <a href="#" class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><i class="fab fa-facebook-f fa-lg"></i></a>
                    <a href="#" class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><i class="fab fa-whatsapp fa-lg"></i></a>
                </div>
            </div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-900 py-4">
            <div class="container mx-auto text-center text-xs text-gray-500 dark:text-gray-400">
                <p>&copy; 2025 Curtindo SC Imóveis. Todos os direitos reservados.</p>
                <p class="mt-1">CRECI/SC 38249 | Responsável Técnico: Diego Lemes</p>
            </div>
        </div>
    </footer>


    <div id="details-modal" class="modal fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-gray-900 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col md:flex-row">
            <div class="w-full md:w-1/2 flex flex-col bg-black rounded-t-lg md:rounded-l-lg md:rounded-t-none">
                <div class="relative flex-grow"><img id="modal-main-image" src="" class="w-full h-full object-contain"><div id="prev-image" class="gallery-arrow left-2"><i class="fas fa-chevron-left"></i></div><div id="next-image" class="gallery-arrow right-2"><i class="fas fa-chevron-right"></i></div></div>
                <div id="thumbnail-container" class="thumbnail-container flex space-x-2 p-2 overflow-x-auto bg-black/50"></div>
            </div>
            <div class="w-full md:w-1/2 p-8 flex flex-col overflow-y-auto">
                <div class="flex-grow">
                    <div class="flex justify-between items-start"><h2 id="modal-title" class="text-3xl font-bold text-gray-900 dark:text-white"></h2><button id="close-modal-button" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white text-3xl">&times;</button></div>
                    <p id="modal-location" class="text-gray-500 dark:text-gray-400 mt-1 mb-4"><i class="fas fa-map-marker-alt mr-1"></i></p>
                    <div class="flex flex-wrap items-center gap-x-4 gap-y-2 mb-4 text-gray-600 dark:text-gray-300">
                        <span id="bedrooms-info"><i class="fas fa-bed mr-1"></i> <span id="modal-bedrooms"></span> Quarto(s)</span>
                        <span id="bathrooms-info"><i class="fas fa-bath mr-1"></i> <span id="modal-bathrooms"></span> Banheiro(s)</span>
                        <span><i class="fas fa-ruler-combined mr-1"></i> <span id="modal-area"></span> m²</span>
                    </div>
                    <p id="modal-description" class="text-gray-600 dark:text-gray-300 mb-6"></p>
                    <div class="mb-6"><h4 class="font-bold mb-2 text-gray-900 dark:text-white">Características</h4><div id="modal-features" class="grid grid-cols-2 gap-4 text-sm"></div></div>
                </div>
                <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg mt-auto">
                    <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Gostou deste imóvel?</h3>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white mb-4">R$ <span id="modal-price"></span></p>
                    <form id="contact-form" class="space-y-4">
                        <div><label for="guest-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nome completo</label><input type="text" id="guest-name" placeholder="O seu nome" required class="mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm"></div>
                        <div><label for="guest-contact" class="block text-sm font-medium text-gray-700 dark:text-gray-300">WhatsApp / Telefone</label><input type="tel" id="guest-contact" placeholder="(XX) XXXXX-XXXX" required class="mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm"></div>
                        <div><label for="guest-message" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Mensagem (opcional)</label><textarea id="guest-message" rows="2" placeholder="Tenho interesse neste imóvel..." class="mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm"></textarea></div>
                        <button type="submit" id="contact-button" class="w-full bg-gray-900 hover:bg-gray-700 dark:bg-gray-100 dark:text-gray-900 dark:hover:bg-gray-200 text-white font-bold py-3 px-4 rounded-lg">Solicitar Contato</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="alert-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-50"><div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center"><h2 id="alert-title" class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">Aviso</h2><p id="alert-message" class="mb-6 text-gray-600 dark:text-gray-300"></p><button id="alert-ok-button" class="px-6 py-2 bg-gray-900 dark:bg-gray-100 dark:text-gray-900 text-white rounded-lg font-semibold">OK</button></div></div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, getDoc, addDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        const firebaseConfig = { apiKey: "AIzaSyBjQ2S36qboQhqH96hiWZe-F8QPw6e31dA", authDomain: "curtindo-sc-reservas.firebaseapp.com", projectId: "curtindo-sc-reservas", storageBucket: "curtindo-sc-reservas.appspot.com", messagingSenderId: "720754493665", appId: "1:720754493665:web:7c7bed51a6b2a04a0f4fa0", measurementId: "G-Z7Q538WYZ2" };

        const loadingEl = document.getElementById('loading');
        const propertiesGridEl = document.getElementById('properties-grid');
        const detailsModal = document.getElementById('details-modal');
        const alertModal = document.getElementById('alert-modal');
        let db, auth, allProperties = [], currentProperty = null, currentImageIndex = 0;
        const showAlert = (message, title = "Aviso") => { document.getElementById('alert-title').textContent = title; document.getElementById('alert-message').textContent = message; alertModal.classList.add('show'); };
        document.getElementById('alert-ok-button').addEventListener('click', () => document.querySelectorAll('.modal').forEach(m => m.classList.remove('show')));
        
        async function main() { 
            if (!firebaseConfig.apiKey) { loadingEl.innerHTML = `<p class="text-red-500">Erro: Configuração do Firebase ausente.</p>`; return; } 
            try { 
                const app = initializeApp(firebaseConfig); 
                db = getFirestore(app); 
                auth = getAuth(app); 
                onAuthStateChanged(auth, user => { if (user) loadProperties(); }); 
                await signInAnonymously(auth); 
            } catch (e) { 
                loadingEl.style.display = 'none'; 
                showAlert("Não foi possível conectar à base de dados.", "Erro de Conexão"); 
                console.error("Erro na inicialização:", e); 
            } 
        }

        function loadProperties() { 
            renderAppreciationChart();
            const path = "properties"; 
            onSnapshot(query(collection(db, path), orderBy("name")), snapshot => { 
                loadingEl.style.display = 'none'; 
                allProperties = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); 
                renderFilters(allProperties);
                renderProperties(allProperties); 
            }, error => { 
                loadingEl.style.display = 'none'; 
                showAlert("Não foi possível carregar os imóveis. Verifique as regras de segurança do Firestore.", "Erro de Conexão"); 
                console.error(error); 
            }); 
        }

        function renderFilters(properties) {
            const filterContainer = document.getElementById('filter-container');
            filterContainer.querySelectorAll('.filter-btn:not([data-filter="all"])').forEach(btn => btn.remove());
            
            const propertyTypes = [...new Set(properties.map(p => p.property_type))];
            propertyTypes.forEach(type => {
                if (type && !document.querySelector(`button[data-filter="${type}"]`)) {
                    const button = document.createElement('button');
                    button.dataset.filter = type;
                    button.className = 'filter-btn bg-white text-gray-800 border border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 px-6 py-2 rounded-full font-semibold shadow-md';
                    button.textContent = type;
                    filterContainer.appendChild(button);
                }
            });

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => { 
                    document.querySelectorAll('.filter-btn').forEach(b => { 
                        b.classList.remove('bg-gray-900', 'text-white', 'active'); 
                        b.classList.add('bg-white', 'text-gray-800', 'border', 'border-gray-200', 'dark:bg-gray-800', 'dark:text-gray-200', 'dark:border-gray-700'); 
                    }); 
                    btn.classList.add('bg-gray-900', 'text-white', 'active'); 
                    btn.classList.remove('bg-white', 'text-gray-800', 'border', 'border-gray-200', 'dark:bg-gray-800', 'dark:text-gray-200', 'dark:border-gray-700'); 
                    const filter = btn.dataset.filter; 
                    if (filter === 'all') renderProperties(allProperties); 
                    else renderProperties(allProperties.filter(p => p.property_type === filter)); 
                });
            });
        }

        function renderProperties(properties) { 
            propertiesGridEl.innerHTML = ''; 
            if (properties.length === 0) {
                 propertiesGridEl.innerHTML = `<p class="col-span-full text-center text-gray-500 dark:text-gray-400 py-10">Nenhum imóvel encontrado para este filtro.</p>`;
                 return;
            }
            properties.forEach(prop => { 
                const card = document.createElement('div'); 
                card.className = 'property-card bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer group'; 
                card.dataset.id = prop.id; 
                card.innerHTML = `<div class="overflow-hidden h-64"><img src="${(prop.images && prop.images.length > 0) ? prop.images[0] : 'https://placehold.co/600x400/e2e8f0/e2e8f0?text=Imóvel'}" alt="${prop.name}" class="property-image w-full h-full object-cover"></div><div class="p-6"><h3 class="text-xl font-bold text-gray-900 dark:text-white">${prop.name}</h3><p class="text-gray-500 dark:text-gray-400 mt-1"><i class="fas fa-map-marker-alt mr-1"></i> ${prop.location}</p><p class="text-lg font-bold text-gray-900 dark:text-white mt-4">R$ ${prop.price_sale.toLocaleString('pt-BR')}</p></div>`; 
                propertiesGridEl.appendChild(card); 
            }); 
        }
        
        propertiesGridEl.addEventListener('click', e => { const card = e.target.closest('.property-card'); if (card) { currentProperty = allProperties.find(p => p.id === card.dataset.id); if (currentProperty) openDetailsModal(currentProperty); } });
        
        const featureIcons = { piscina: 'fa-swimmer', garagem: 'fa-car', churrasqueira: 'fa-hamburger', vista_mar: 'fa-water', mobiliado: 'fa-couch', academia: 'fa-dumbbell', salao_festas: 'fa-glass-cheers', portaria_24h: 'fa-user-shield' };
        const featureLabels = { piscina: 'Piscina', garagem: 'Garagem', churrasqueira: 'Churrasqueira', vista_mar: 'Vista p/ Mar', mobiliado: 'Mobiliado', academia: 'Academia', salao_festas: 'Salão de Festas', portaria_24h: 'Portaria 24h' };

        function openDetailsModal(prop) {
            currentImageIndex = 0;
            document.getElementById('modal-title').textContent = prop.name;
            document.getElementById('modal-location').innerHTML = `<i class="fas fa-map-marker-alt mr-1"></i> ${prop.location}`;
            
            const bedroomsInfo = document.getElementById('bedrooms-info');
            if (prop.bedrooms && prop.bedrooms > 0) {
                document.getElementById('modal-bedrooms').textContent = prop.bedrooms;
                bedroomsInfo.style.display = 'inline-block';
            } else {
                bedroomsInfo.style.display = 'none';
            }

            const bathroomsInfo = document.getElementById('bathrooms-info');
             if (prop.bathrooms && prop.bathrooms > 0) {
                document.getElementById('modal-bathrooms').textContent = prop.bathrooms;
                bathroomsInfo.style.display = 'inline-block';
            } else {
                bathroomsInfo.style.display = 'none';
            }
            
            document.getElementById('modal-area').textContent = prop.area_sqm;
            document.getElementById('modal-description').textContent = prop.description;
            document.getElementById('modal-price').textContent = prop.price_sale.toLocaleString('pt-BR');
            
            const featuresContainer = document.getElementById('modal-features');
            featuresContainer.innerHTML = '';
            if (prop.features && prop.features.length > 0) {
                prop.features.forEach(key => {
                    featuresContainer.innerHTML += `<div class="flex items-center space-x-2"><i class="fas ${featureIcons[key] || 'fa-check'} text-gray-500 dark:text-gray-400 w-5 text-center"></i><span>${featureLabels[key] || key}</span></div>`;
                });
            } else {
                featuresContainer.innerHTML = `<p class="text-gray-500 dark:text-gray-400">Nenhuma característica especial listada.</p>`;
            }
            updateGallery();
            detailsModal.classList.add('show');
        }

        function updateGallery() {
            const mainImage = document.getElementById('modal-main-image'), thumbnailContainer = document.getElementById('thumbnail-container');
            if (currentProperty.images && currentProperty.images.length > 0) {
                mainImage.src = currentProperty.images[currentImageIndex];
                thumbnailContainer.innerHTML = '';
                currentProperty.images.forEach((imgSrc, index) => {
                    const thumb = document.createElement('img');
                    thumb.src = imgSrc;
                    thumb.className = `thumbnail h-16 w-16 object-cover rounded ${index === currentImageIndex ? 'active' : ''}`;
                    thumb.dataset.index = index;
                    thumb.addEventListener('click', () => { currentImageIndex = index; updateGallery(); });
                    thumbnailContainer.appendChild(thumb);
                });
                thumbnailContainer.children[currentImageIndex]?.scrollIntoView({ behavior: 'smooth', inline: 'center' });
            } else {
                mainImage.src = 'https://placehold.co/600x400/e2e8f0/e2e8f0?text=Imóvel';
                thumbnailContainer.innerHTML = '';
            }
        }

        document.getElementById('prev-image').addEventListener('click', () => { if (currentProperty.images && currentProperty.images.length > 1) { currentImageIndex = (currentImageIndex - 1 + currentProperty.images.length) % currentProperty.images.length; updateGallery(); } });
        document.getElementById('next-image').addEventListener('click', () => { if (currentProperty.images && currentProperty.images.length > 1) { currentImageIndex = (currentImageIndex + 1) % currentProperty.images.length; updateGallery(); } });
        document.getElementById('close-modal-button').addEventListener('click', () => detailsModal.classList.remove('show'));
        
        document.getElementById('contact-form').addEventListener('submit', async (e) => { 
            e.preventDefault();
            const guestName = document.getElementById('guest-name').value.trim();
            const guestContact = document.getElementById('guest-contact').value.trim();
            if (!guestName || !guestContact) {
                showAlert('Por favor, preencha o seu nome e contato.');
                return;
            }
            const contactData = {
                propertyId: currentProperty.id,
                propertyName: currentProperty.name,
                guestName,
                guestContact,
                message: document.getElementById('guest-message').value.trim(),
                submissionDate: serverTimestamp()
            };
            try {
                const path = "contacts";
                await addDoc(collection(db, path), contactData);
                showAlert(`Obrigado, ${guestName}! O seu interesse foi registado. Entraremos em contato em breve.`, 'Contato Enviado');
                detailsModal.classList.remove('show');
                document.getElementById('contact-form').reset();
            } catch (error) {
                showAlert('Não foi possível enviar o seu contato. Tente novamente.', 'Erro');
                console.error("Erro ao enviar contato:", error);
            }
        });
        
        function renderAppreciationChart() {
            const ctx = document.getElementById('appreciation-chart').getContext('2d');
            const isDarkMode = document.documentElement.classList.contains('dark');
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            const labelColor = isDarkMode ? '#cbd5e1' : '#4b5563';

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2022', '2023', '2024', '2025 (Proj.)'],
                    datasets: [{
                        label: 'Valorização Média Anual (%)',
                        data: [14.1, 16.5, 17.2, 18.0],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) { return value + '%'; },
                                color: labelColor,
                            },
                             grid: { color: gridColor }
                        },
                        x: {
                            ticks: { color: labelColor },
                            grid: { color: gridColor }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: labelColor } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` Valorização: ${context.parsed.y}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        const themeToggle = document.getElementById('theme-toggle'), sunIcon = document.getElementById('theme-icon-sun'), moonIcon = document.getElementById('theme-icon-moon');
        const applyTheme = theme => { if (theme === 'dark') { document.documentElement.classList.add('dark'); sunIcon.classList.remove('hidden'); moonIcon.classList.add('hidden'); } else { document.documentElement.classList.remove('dark'); sunIcon.classList.add('hidden'); moonIcon.classList.remove('hidden'); } };
        themeToggle.addEventListener('click', () => { const isDark = document.documentElement.classList.toggle('dark'), newTheme = isDark ? 'dark' : 'light'; localStorage.setItem('theme', newTheme); applyTheme(newTheme); });
        applyTheme(localStorage.getItem('theme') || 'light');
        main();
    </script>
</body>
</html>

