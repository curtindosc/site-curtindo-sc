<!DOCTYPE html>
<html lang="pt-BR" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curtindo SC - Im√≥veis √† Venda e Aluguel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .modal { display: none; }
        .modal.show { display: flex; }
        .property-card:hover .property-image { transform: scale(1.05); }
        .property-image { transition: transform 0.3s ease-in-out; }
        .thumbnail-container { scrollbar-width: thin; scrollbar-color: #4B5563 #1F2937; }
        .thumbnail-container::-webkit-scrollbar { height: 8px; }
        .thumbnail-container::-webkit-scrollbar-track { background: #1F2937; }
        .thumbnail-container::-webkit-scrollbar-thumb { background-color: #4B5563; border-radius: 4px; }
        .thumbnail { cursor: pointer; border: 2px solid transparent; transition: border-color 0.2s; }
        .thumbnail.active { border-color: #3B82F6; }
        .gallery-arrow { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0, 0, 0, 0.5); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background-color 0.2s; }
        .gallery-arrow:hover { background-color: rgba(0, 0, 0, 0.8); }
        /* Estilos para os bot√µes de modo */
        .mode-btn.active {
            background-color: #1F2937; /* Gray-900 */
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .mode-btn:not(.active) {
            background-color: white;
            color: #1F2937;
            border: 2px solid #D1D5DB; /* Gray-300 */
        }
        .dark .mode-btn:not(.active) {
            background-color: #1F2937;
            color: #D1D5DB;
            border: 2px solid #4B5563; /* Gray-600 */
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div class="container mx-auto p-4 md:p-8">
        <div class="absolute top-4 right-4">
            <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                <svg id="theme-icon-sun" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="theme-icon-moon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </div>
        <header class="text-center mb-6 pt-10">
            <img src="https://media.bio.site/sites/15fc0509-6c95-4782-9a79-fe69fe78ce69/fetqsktutwxDYURdXexgei.jpg" alt="Logo Curtindo SC" class="mx-auto mb-4 h-32 w-32 object-cover rounded-full border-4 border-white dark:border-gray-700 shadow-lg">
            <h1 class="text-5xl font-bold text-gray-900 dark:text-white">Curtindo SC Im√≥veis</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2 text-xl font-medium">Seu passaporte para **curtir para sempre** em SC.</p>
        </header>

        <section class="mb-10 flex justify-center space-x-4">
            <button data-mode="sale" id="filter-sale" class="mode-btn px-8 py-3 rounded-xl font-bold text-lg transition-all duration-300 active">
                Comprar
            </button>
            <button data-mode="rent" id="filter-rent" class="mode-btn px-8 py-3 rounded-xl font-bold text-lg transition-all duration-300">
                Alugar
            </button>
        </section>
        <section class="mb-12 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-900 dark:text-white">Valoriza√ß√£o Hist√≥rica: Im√≥veis P√© na Areia de SC üìà</h2>
            <p class="text-center text-gray-600 dark:text-gray-400 mb-6 text-sm">Fonte: Dados simulados baseados no √≠ndice FipeZAP+ (2025 √© uma proje√ß√£o)</p>
            <div class="h-64 md:h-80">
                <canvas id="appreciation-chart"></canvas>
            </div>
        </section>

        <div id="filter-container" class="flex justify-center flex-wrap gap-2 md:gap-4 mb-10">
            <button data-filter="all" class="filter-btn active bg-gray-900 text-white px-6 py-2 rounded-full font-semibold shadow-md">Todos</button>
        </div>
        <main id="properties-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></main>
        <div id="loading" class="text-center py-12"><p class="text-gray-600 dark:text-gray-400 text-lg">A carregar os melhores im√≥veis...</p></div>
    </div>

    <footer class="bg-white dark:bg-gray-800 mt-16 border-t border-gray-200 dark:border-gray-700">
        <div class="container mx-auto py-8 px-4">
            <div class="text-center text-gray-600 dark:text-gray-400">
                <p class="font-bold text-lg text-gray-800 dark:text-white">Curtindo SC Im√≥veis</p>
                <p class="text-sm mt-2">Transformando sonhos em realidade no litoral e na serra catarinense.</p>
                <div class="flex justify-center space-x-6 mt-4">
                    <a href="https://www.instagram.com/curtindosc/" target="_blank" class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><i class="fab fa-instagram fa-lg"></i></a>
                    <a href="https://www.tiktok.com/@curtindosc" target="_blank" class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><i class="fab fa-tiktok fa-lg"></i></a>
                    <a href="https://api.whatsapp.com/send/?phone=5548991212221" target="_blank" class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><i class="fab fa-whatsapp fa-lg"></i></a>
                    <a href="https://www.facebook.com/curtindosc" target="_blank" class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><i class="fab fa-facebook-f fa-lg"></i></a>
                    <a href="https://www.youtube.com/@curtindosc" target="_blank" class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"><i class="fab fa-youtube fa-lg"></i></a>
                </div>
            </div>
        </div>
        <div class="bg-gray-50 dark:bg-gray-900 py-4">
            <div class="container mx-auto text-center text-xs text-gray-500 dark:text-gray-400">
                <p>&copy; 2025 Curtindo SC Im√≥veis. Todos os direitos reservados.</p>
                <p class="mt-1">CRECI/SC 38249 | Respons√°vel T√©cnico: Diego Lemes</p>
            </div>
        </div>
    </footer>


    <div id="details-modal" class="modal fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-gray-900 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col md:flex-row">
            <div class="w-full md:w-1/2 flex flex-col bg-black rounded-t-lg md:rounded-l-lg md:rounded-t-none">
                <div class="relative flex-grow"><img id="modal-main-image" src="" class="w-full h-full object-contain"><div id="prev-image" class="gallery-arrow left-2"><i class="fas fa-chevron-left"></i></div><div id="next-image" class="gallery-arrow right-2"><i class="fas fa-chevron-right"></i></div></div>
                <div id="thumbnail-container" class="thumbnail-container flex space-x-2 p-2 overflow-x-auto bg-black/50"></div>
            </div>
            <div class="w-full md:w-1/2 p-8 flex flex-col overflow-y-auto">
                <div class="flex-grow">
                    <div class="flex justify-between items-start"><h2 id="modal-title" class="text-3xl font-bold text-gray-900 dark:text-white"></h2><button id="close-modal-button" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white text-3xl">&times;</button></div>
                    <p id="modal-location" class="text-gray-500 dark:text-gray-400 mt-1 mb-4"><i class="fas fa-map-marker-alt mr-1"></i></p>
                    <div class="flex flex-wrap items-center gap-x-4 gap-y-2 mb-4 text-gray-600 dark:text-gray-300">
                        <span id="bedrooms-info"><i class="fas fa-bed mr-1"></i> <span id="modal-bedrooms"></span> Quarto(s)</span>
                        <span id="bathrooms-info"><i class="fas fa-bath mr-1"></i> <span id="modal-bathrooms"></span> Banheiro(s)</span>
                        <span><i class="fas fa-ruler-combined mr-1"></i> <span id="modal-area"></span> m¬≤</span>
                    </div>
                    <p id="modal-description" class="text-gray-600 dark:text-gray-300 mb-6"></p>
                    <div class="mb-6"><h4 class="font-bold mb-2 text-gray-900 dark:text-white">Caracter√≠sticas</h4><div id="modal-features" class="grid grid-cols-2 gap-4 text-sm"></div></div>
                </div>
                <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg mt-auto">
                    <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Gostou deste im√≥vel?</h3>
                    
                    <p id="modal-price-label" class="text-base text-gray-700 dark:text-gray-300 font-semibold"></p>
                    
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mb-4">
                        <span id="modal-price"></span>
                    </p>

                    <p id="dates-info" class="text-sm text-blue-600 dark:text-blue-400 mb-4 font-medium hidden"></p>

                    <form id="contact-form" class="space-y-4">
                        <div><label for="guest-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nome completo</label><input type="text" id="guest-name" placeholder="O seu nome" required class="mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm"></div>
                        <div><label for="guest-contact" class="block text-sm font-medium text-gray-700 dark:text-gray-300">WhatsApp / Telefone</label><input type="tel" id="guest-contact" placeholder="(48) 99131-1442" required class="mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm"></div>
                        <div><label for="guest-message" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Mensagem (opcional)</label><textarea id="guest-message" rows="2" placeholder="Tenho interesse neste im√≥vel..." class="mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm"></textarea></div>
                        <button type="submit" id="contact-button" class="w-full bg-gray-900 hover:bg-gray-700 dark:bg-gray-100 dark:text-gray-900 dark:hover:bg-gray-200 text-white font-bold py-3 px-4 rounded-lg">Solicitar Contato via WhatsApp</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="alert-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 z-50"><div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm text-center"><h2 id="alert-title" class="text-2xl font-bold mb-4 text-gray-900 dark:text-white">Aviso</h2><p id="alert-message" class="mb-6 text-gray-600 dark:text-gray-300"></p><button id="alert-ok-button" class="px-6 py-2 bg-gray-900 dark:bg-gray-100 dark:text-gray-900 text-white rounded-lg font-semibold">OK</button></div></div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, getDoc, addDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        const firebaseConfig = { apiKey: "AIzaSyBjQ2S36qboQhqH96hiWZe-F8QPw6e31dA", authDomain: "curtindo-sc-reservas.firebaseapp.com", projectId: "curtindo-sc-reservas", storageBucket: "curtindo-sc-reservas.appspot.com", messagingSenderId: "720754493665", appId: "1:720754493665:web:7c7bed51a6b2a04a0f4fa0", measurementId: "G-Z7Q538WYZ2" };

        const loadingEl = document.getElementById('loading');
        const propertiesGridEl = document.getElementById('properties-grid');
        const detailsModal = document.getElementById('details-modal');
        const alertModal = document.getElementById('alert-modal');
        
        // NOVO ESTADO GLOBAL
        let db, auth, allProperties = [], currentProperty = null, currentImageIndex = 0;
        let currentMode = 'sale'; // 'sale' ou 'rent'

        const showAlert = (message, title = "Aviso") => { document.getElementById('alert-title').textContent = title; document.getElementById('alert-message').textContent = message; alertModal.classList.add('show'); };
        document.getElementById('alert-ok-button').addEventListener('click', () => document.querySelectorAll('.modal').forEach(m => m.classList.remove('show')));
        
        // Fun√ß√£o para formatar n√∫meros para BRL
        const formatBRL = (number) => number.toLocaleString('pt-BR');

        async function main() { 
            if (!firebaseConfig.apiKey) { loadingEl.innerHTML = `<p class="text-red-500">Erro: Configura√ß√£o do Firebase ausente.</p>`; return; } 
            try { 
                const app = initializeApp(firebaseConfig); 
                db = getFirestore(app); 
                auth = getAuth(app); 
                onAuthStateChanged(auth, user => { if (user) loadProperties(); }); 
                await signInAnonymously(auth); 
            } catch (e) { 
                loadingEl.style.display = 'none'; 
                showAlert("N√£o foi poss√≠vel conectar √† base de dados.", "Erro de Conex√£o"); 
                console.error("Erro na inicializa√ß√£o:", e); 
            } 
        }

        function loadProperties() { 
            renderAppreciationChart();
            const path = "properties"; 
            onSnapshot(query(collection(db, path), orderBy("name")), snapshot => { 
                loadingEl.style.display = 'none'; 
                allProperties = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); 
                renderFilters(allProperties);
                renderProperties(allProperties); // Inicia a renderiza√ß√£o no modo 'sale' (padr√£o)
            }, error => { 
                loadingEl.style.display = 'none'; 
                showAlert("N√£o foi poss√≠vel carregar os im√≥veis. Verifique as regras de seguran√ßa do Firestore.", "Erro de Conex√£o"); 
                console.error(error); 
            }); 
        }

        function renderFilters(properties) {
            const filterContainer = document.getElementById('filter-container');
            // Remove bot√µes de filtro antigos (exceto "Todos")
            filterContainer.querySelectorAll('.filter-btn:not([data-filter="all"])').forEach(btn => btn.remove());
            
            // Filtra as propriedades de acordo com o modo atual para gerar os filtros de tipo corretos
            const propertiesToFilter = properties.filter(p => p.mode === currentMode);
            const propertyTypes = [...new Set(propertiesToFilter.map(p => p.property_type))];
            
            propertyTypes.forEach(type => {
                if (type && !document.querySelector(`button[data-filter="${type}"]`)) {
                    const button = document.createElement('button');
                    button.dataset.filter = type;
                    button.className = 'filter-btn bg-white text-gray-800 border border-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 px-6 py-2 rounded-full font-semibold shadow-md';
                    button.textContent = type;
                    filterContainer.appendChild(button);
                }
            });

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => { 
                    document.querySelectorAll('.filter-btn').forEach(b => { 
                        b.classList.remove('bg-gray-900', 'text-white', 'active'); 
                        b.classList.add('bg-white', 'text-gray-800', 'border', 'border-gray-200', 'dark:bg-gray-800', 'dark:text-gray-200', 'dark:border-gray-700'); 
                    }); 
                    btn.classList.add('bg-gray-900', 'text-white', 'active'); 
                    btn.classList.remove('bg-white', 'text-gray-800', 'border', 'border-gray-200', 'dark:bg-gray-800', 'dark:text-gray-200', 'dark:border-gray-700'); 
                    const filter = btn.dataset.filter; 
                    
                    // Aplica o filtro de tipo APENAS nos im√≥veis j√° filtrados pelo MODO
                    const propertiesToRender = allProperties.filter(p => p.mode === currentMode);
                    if (filter === 'all') renderProperties(propertiesToRender); 
                    else renderProperties(propertiesToRender.filter(p => p.property_type === filter)); 
                });
            });
        }

        function renderProperties(properties) { 
            // Localize esta linha (aproximadamente linha 200):
// const filteredByMode = properties.filter(p => p.mode === currentMode);

// SUBSTITUA por esta l√≥gica corrigida:
const filteredByMode = properties.filter(p => {
    // Se o modo for 'sale', aceita tanto 'sale' quanto undefined/null (im√≥veis antigos)
    if (currentMode === 'sale') {
        return p.mode === 'sale' || !p.mode; 
    }
    // Se o modo for 'rent', exige explicitamente o modo 'rent'
    return p.mode === currentMode;
});

            propertiesGridEl.innerHTML = ''; 
            if (filteredByMode.length === 0) {
                propertiesGridEl.innerHTML = `<p class="col-span-full text-center text-gray-500 dark:text-gray-400 py-10">Nenhum im√≥vel de ${currentMode === 'sale' ? 'Venda' : 'Aluguel'} encontrado.</p>`;
                return;
            }
            
            filteredByMode.forEach(prop => {
                let displayPrice = '';
                let badgeHtml = '';
                let priceClass = '';
                
                if (prop.mode === 'sale') {
                    displayPrice = `R$ ${prop.price_sale ? formatBRL(prop.price_sale) : 'Consulte'}`;
                    badgeHtml = `<span class="absolute top-3 left-3 px-3 py-1 text-sm font-bold rounded-full z-10 bg-green-600 text-white">VENDA</span>`;
                    priceClass = 'text-green-600';
                } else { // mode === 'rent'
                    if (prop.price_daily) {
                        displayPrice = `R$ ${formatBRL(prop.price_daily)} / Di√°ria`;
                    } else if (prop.price_monthly) {
                        displayPrice = `R$ ${formatBRL(prop.price_monthly)} / M√™s`;
                    } else {
                        displayPrice = 'Consulte';
                    }
                    badgeHtml = `<span class="absolute top-3 left-3 px-3 py-1 text-sm font-bold rounded-full z-10 bg-blue-600 text-white">ALUGUEL</span>`;
                    priceClass = 'text-blue-600';
                }

                const card = document.createElement('div'); 
                card.className = 'property-card bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer group'; 
                card.dataset.id = prop.id; 
                card.innerHTML = `
                    <div class="relative overflow-hidden h-64">
                        ${badgeHtml}
                        <img src="${(prop.images && prop.images.length > 0) ? prop.images[0] : 'https://placehold.co/600x400/e2e8f0/e2e8f0?text=Im√≥vel'}" alt="${prop.name}" class="property-image w-full h-full object-cover">
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">${prop.name}</h3>
                        <p class="text-gray-500 dark:text-gray-400 mt-1"><i class="fas fa-map-marker-alt mr-1"></i> ${prop.location}</p>
                        <p class="text-lg font-bold ${priceClass} mt-4">${displayPrice}</p>
                    </div>
                `; 
                propertiesGridEl.appendChild(card); 
            }); 
        }
        
        propertiesGridEl.addEventListener('click', e => { const card = e.target.closest('.property-card'); if (card) { currentProperty = allProperties.find(p => p.id === card.dataset.id); if (currentProperty) openDetailsModal(currentProperty); } });
        
        const featureIcons = { piscina: 'fa-swimmer', garagem: 'fa-car', churrasqueira: 'fa-hamburger', vista_mar: 'fa-water', mobiliado: 'fa-couch', academia: 'fa-dumbbell', salao_festas: 'fa-glass-cheers', portaria_24h: 'fa-user-shield' };
        const featureLabels = { piscina: 'Piscina', garagem: 'Garagem', churrasqueira: 'Churrasqueira', vista_mar: 'Vista p/ Mar', mobiliado: 'Mobiliado', academia: 'Academia', salao_festas: 'Sal√£o de Festas', portaria_24h: 'Portaria 24h' };

        // openDetailsModal ajustado para Aluguel/Venda
        function openDetailsModal(prop) {
            currentImageIndex = 0;
            document.getElementById('modal-title').textContent = prop.name;
            document.getElementById('modal-location').innerHTML = `<i class="fas fa-map-marker-alt mr-1"></i> ${prop.location}`;
            
            const bedroomsInfo = document.getElementById('bedrooms-info');
            const bathroomsInfo = document.getElementById('bathrooms-info');
            
            // Exibir/Ocultar Quartos/Banheiros
            if (prop.bedrooms && prop.bedrooms > 0) {
                document.getElementById('modal-bedrooms').textContent = prop.bedrooms;
                bedroomsInfo.style.display = 'inline-block';
            } else { bedroomsInfo.style.display = 'none'; }

            if (prop.bathrooms && prop.bathrooms > 0) {
                document.getElementById('modal-bathrooms').textContent = prop.bathrooms;
                bathroomsInfo.style.display = 'inline-block';
            } else { bathroomsInfo.style.display = 'none'; }
            
            document.getElementById('modal-area').textContent = prop.area_sqm;
            document.getElementById('modal-description').textContent = prop.description;

            // L√≥gica de Pre√ßo do Modal (NOVA)
            const priceLabelEl = document.getElementById('modal-price-label');
            const priceValueEl = document.getElementById('modal-price');
            const datesInfoEl = document.getElementById('dates-info');
            
            let displayPriceValue = 'Consulte';

            if (prop.mode === 'sale') {
                priceLabelEl.textContent = 'Pre√ßo de Venda';
                displayPriceValue = prop.price_sale ? formatBRL(prop.price_sale) : 'Consulte';
                datesInfoEl.classList.add('hidden');
            } else { // mode === 'rent'
                if (prop.price_daily) {
                    priceLabelEl.textContent = 'Valor da Di√°ria (Est.)';
                    displayPriceValue = formatBRL(prop.price_daily);
                } else if (prop.price_monthly) {
                    priceLabelEl.textContent = 'Valor Mensal (Est.)';
                    displayPriceValue = formatBRL(prop.price_monthly);
                } else {
                    priceLabelEl.textContent = 'Pre√ßo';
                    displayPriceValue = 'Consulte';
                }
                
                // Exibir Datas de Aluguel
                if (prop.available_start && prop.available_end) {
                     const startDate = new Date(prop.available_start.seconds * 1000);
                     const endDate = new Date(prop.available_end.seconds * 1000);
                     
                     // Formata a data para dd/mm/aaaa
                     const start = startDate.toLocaleDateString('pt-BR');
                     const end = endDate.toLocaleDateString('pt-BR');

                     datesInfoEl.innerHTML = `<i class="fas fa-calendar-alt mr-1"></i> Dispon√≠vel: ${start} at√© ${end}`;
                     datesInfoEl.classList.remove('hidden');
                } else {
                     datesInfoEl.classList.add('hidden');
                }
            }
            priceValueEl.textContent = displayPriceValue;

            // --- L√≥gica de Features (permanece a mesma) ---
            const featuresContainer = document.getElementById('modal-features');
            featuresContainer.innerHTML = '';
            if (prop.features && prop.features.length > 0) {
                prop.features.forEach(key => {
                    featuresContainer.innerHTML += `<div class="flex items-center space-x-2"><i class="fas ${featureIcons[key] || 'fa-check'} text-gray-500 dark:text-gray-400 w-5 text-center"></i><span>${featureLabels[key] || key}</span></div>`;
                });
            } else { featuresContainer.innerHTML = `<p class="text-gray-500 dark:text-gray-400">Nenhuma caracter√≠stica especial listada.</p>`; }
            
            updateGallery();
            detailsModal.classList.add('show');
        }

        function updateGallery() {
            const mainImage = document.getElementById('modal-main-image'), thumbnailContainer = document.getElementById('thumbnail-container');
            if (currentProperty.images && currentProperty.images.length > 0) {
                mainImage.src = currentProperty.images[currentImageIndex];
                thumbnailContainer.innerHTML = '';
                currentProperty.images.forEach((imgSrc, index) => {
                    const thumb = document.createElement('img');
                    thumb.src = imgSrc;
                    thumb.className = `thumbnail h-16 w-16 object-cover rounded ${index === currentImageIndex ? 'active' : ''}`;
                    thumb.dataset.index = index;
                    thumb.addEventListener('click', () => { currentImageIndex = index; updateGallery(); });
                    thumbnailContainer.appendChild(thumb);
                });
                thumbnailContainer.children[currentImageIndex]?.scrollIntoView({ behavior: 'smooth', inline: 'center' });
            } else {
                mainImage.src = 'https://placehold.co/600x400/e2e8f0/e2e8f0?text=Im√≥vel';
                thumbnailContainer.innerHTML = '';
            }
        }

        document.getElementById('prev-image').addEventListener('click', () => { if (currentProperty.images && currentProperty.images.length > 1) { currentImageIndex = (currentImageIndex - 1 + currentProperty.images.length) % currentProperty.images.length; updateGallery(); } });
        document.getElementById('next-image').addEventListener('click', () => { if (currentProperty.images && currentProperty.images.length > 1) { currentImageIndex = (currentImageIndex + 1) % currentProperty.images.length; updateGallery(); } });
        document.getElementById('close-modal-button').addEventListener('click', () => detailsModal.classList.remove('show'));
        
        // L√≥gica do Formul√°rio de Contato (AJUSTADA para Venda/Aluguel)
        document.getElementById('contact-form').addEventListener('submit', async (e) => { 
            e.preventDefault();
            const guestName = document.getElementById('guest-name').value.trim();
            const guestContact = document.getElementById('guest-contact').value.trim();
            if (!guestName || !guestContact) { showAlert('Por favor, preencha o seu nome e contato.'); return; }

            const contactMessagePrefix = currentProperty.mode === 'sale' ? 'compra' : 'aluguel';
            const locationForMessage = currentProperty.location;
            
            const message = `Ol√°! Tenho interesse no ${contactMessagePrefix} do im√≥vel "${currentProperty.name}" (ID: ${currentProperty.id}) em ${locationForMessage}.\n\nNome: ${guestName}\nContato: ${guestContact}\n\nMensagem: ${document.getElementById('guest-message').value.trim()}`;
            const whatsappUrl = `https://api.whatsapp.com/send?phone=5548991311442&text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');

            try {
                const contactData = { propertyId: currentProperty.id, propertyName: currentProperty.name, guestName, guestContact, message: document.getElementById('guest-message').value.trim(), submissionDate: serverTimestamp() };
                await addDoc(collection(db, "contacts"), contactData);
                detailsModal.classList.remove('show');
                document.getElementById('contact-form').reset();
            } catch (error) { console.error("Erro ao guardar contato no Firebase:", error); }
        });
        
        function renderAppreciationChart() {
            const ctx = document.getElementById('appreciation-chart').getContext('2d');
            const isDarkMode = document.documentElement.classList.contains('dark');
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            const labelColor = isDarkMode ? '#cbd5e1' : '#4b5563';

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2022', '2023', '2024', '2025 (Proj.)'],
                    datasets: [{
                        label: 'Valoriza√ß√£o M√©dia Anual (%)',
                        data: [14.1, 16.5, 17.2, 18.0],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) { return value + '%'; },
                                color: labelColor,
                            },
                            grid: { color: gridColor }
                        },
                        x: {
                            ticks: { color: labelColor },
                            grid: { color: gridColor }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: labelColor } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` Valoriza√ß√£o: ${context.parsed.y}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // NOVO: L√≥gica dos bot√µes Comprar/Alugar
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentMode = btn.dataset.mode;
                
                document.querySelectorAll('.mode-btn').forEach(b => {
                    b.classList.remove('active');
                });
                
                btn.classList.add('active');
                
                // Re-renderizar a grid e resetar filtros de tipo
                renderProperties(allProperties);
                // Clica no filtro "Todos" para redefinir o sub-filtro
                document.querySelector('.filter-btn[data-filter="all"]').click(); 
                // Recria os filtros de tipo para o modo selecionado
                renderFilters(allProperties); 
            });
        });

        const themeToggle = document.getElementById('theme-toggle'), sunIcon = document.getElementById('theme-icon-sun'), moonIcon = document.getElementById('theme-icon-moon');
        const applyTheme = theme => { if (theme === 'dark') { document.documentElement.classList.add('dark'); sunIcon.classList.remove('hidden'); moonIcon.classList.add('hidden'); } else { document.documentElement.classList.remove('dark'); sunIcon.classList.add('hidden'); moonIcon.classList.remove('hidden'); } };
        themeToggle.addEventListener('click', () => { const isDark = document.documentElement.classList.toggle('dark'), newTheme = isDark ? 'dark' : 'light'; localStorage.setItem('theme', newTheme); applyTheme(newTheme); });
        applyTheme(localStorage.getItem('theme') || 'light');
        main();
    </script>
</body>
</html>
